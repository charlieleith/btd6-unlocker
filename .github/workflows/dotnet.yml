name: Build (net48)

on:
  workflow_dispatch:
  push:
    branches: [ "main", "master" ]
  pull_request:

jobs:
  build:
    runs-on: windows-latest

    steps:
      - name: Checkout
        uses: actions/checkout@v4

      # Installs MSBuild (Visual Studio Build Tools) on the runner
      - name: Setup MSBuild
        uses: microsoft/setup-msbuild@v2

      # Install .NET Framework 4.8 Targeting Pack (reference assemblies)
      - name: Install .NET Framework 4.8 Developer Pack
        run: choco install netfx-4.8-devpack -y

      # If the repo has packages.config or uses NuGet restore
      - name: NuGet restore (if needed)
        run: |
          nuget help > $null
        shell: pwsh

      # Build: prefer solution if present, else build the csproj directly
      - name: Build
        shell: pwsh
        run: |
          $sln = Get-ChildItem -Recurse -Filter *.sln | Select-Object -First 1
          if ($sln) {
            msbuild $sln.FullName /m /p:Configuration=Release
          } else {
            $proj = Get-ChildItem -Recurse -Filter *.csproj | Select-Object -First 1
            if (-not $proj) { throw "No .sln or .csproj found." }
            msbuild $proj.FullName /m /p:Configuration=Release
          }

      # Upload anything that looks like a Release DLL
      - name: Upload build artifacts
        uses: actions/upload-artifact@v4
        with:
          name: build-output
          path: |
            **\bin\Release\**\*.dll
            **\bin\Release\**\*.pdb
          if-no-files-found: error
